--// Tambahkan di atas / dekat bagian fungsi performSearch
local ESPs = {} -- simpan semua highlight/beam

local function createESP(targetPlayer)
	if not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
	if ESPs[targetPlayer] then return end -- sudah ada ESP
	
	local hrp = targetPlayer.Character.HumanoidRootPart
	
	-- Highlight
	local highlight = Instance.new("Highlight")
	highlight.Adornee = targetPlayer.Character
	highlight.FillColor = Color3.fromRGB(0,255,0)
	highlight.FillTransparency = 0.5
	highlight.OutlineColor = Color3.fromRGB(0,255,0)
	highlight.OutlineTransparency = 0
	highlight.Parent = targetPlayer.Character
	
	-- Beam dari kamera ke pemain
	local att0 = Instance.new("Attachment")
	att0.Position = Vector3.new(0,0,0)
	att0.Parent = workspace.CurrentCamera
	
	local att1 = Instance.new("Attachment")
	att1.Position = Vector3.new(0,3,0)
	att1.Parent = hrp
	
	local beam = Instance.new("Beam")
	beam.Attachment0 = att0
	beam.Attachment1 = att1
	beam.Color = ColorSequence.new(Color3.fromRGB(0,255,0))
	beam.Width0 = 0.1
	beam.Width1 = 0.1
	beam.FaceCamera = true
	beam.Parent = hrp
	
	-- Simpan ESP supaya bisa dihapus
	ESPs[targetPlayer] = {highlight = highlight, beam = beam, att0 = att0, att1 = att1}
end

local function clearESPs()
	for player,data in pairs(ESPs) do
		if data.highlight then data.highlight:Destroy() end
		if data.beam then data.beam:Destroy() end
		if data.att0 then data.att0:Destroy() end
		if data.att1 then data.att1:Destroy() end
	end
	ESPs = {}
end

--// Update performSearch agar bikin ESP
local function performSearch()
	clearResults()
	clearESPs() -- bersihkan highlight lama
	local keyword = string.lower(SearchBox.Text)
	if keyword == "" then return end

	for _, player in pairs(Players:GetPlayers()) do
		local backpack = player:FindFirstChild("Backpack")
		if backpack then
			for _, item in pairs(backpack:GetChildren()) do
				if string.find(string.lower(item.Name), keyword) then
					addResult("Player: "..player.Name.." | Pet: "..item.Name)
					createESP(player) -- tambahkan highlight + beam
				end
			end
		end
	end
end

-- Clear button juga bersihkan ESP
ClearBtn.MouseButton1Click:Connect(function()
	clearResults()
	clearESPs()
	SearchBox.Text = ""
end)
