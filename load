--// SERVICES
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

--// GUI ROOT (FIX CLOSE)
local gui = Instance.new("ScreenGui")
gui.Name = "PetFinderGUI"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

--// MAIN FRAME
local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0,300,0,280)
main.Position = UDim2.new(0.5,-150,0.5,-140)
main.BackgroundColor3 = Color3.fromRGB(30,30,30)
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true

--// HEADER
local header = Instance.new("Frame", main)
header.Size = UDim2.new(1,0,0,30)
header.BackgroundColor3 = Color3.fromRGB(40,40,40)
header.ZIndex = 1

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1,-70,1,0)
title.Position = UDim2.new(0,8,0,0)
title.Text = "Pet Finder"
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Left
title.Active = false
title.Selectable = false
title.ZIndex = 1

local function headBtn(txt,x,col)
	local b = Instance.new("TextButton", header)
	b.Size = UDim2.new(0,30,1,0)
	b.Position = UDim2.new(1,x,0,0)
	b.Text = txt
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = col
	b.ZIndex = 5
	return b
end

local closeBtn = headBtn("X",-30,Color3.fromRGB(170,70,70))
closeBtn.MouseButton1Click:Connect(function()
	gui:Destroy()
end)


--// SEARCH BOX
local searchBox = Instance.new("TextBox", main)
searchBox.Size = UDim2.new(1,-20,0,30)
searchBox.Position = UDim2.new(0,10,0,40)
searchBox.PlaceholderText = "Nama pet..."
searchBox.Text = ""
searchBox.BackgroundColor3 = Color3.fromRGB(45,45,45)
searchBox.TextColor3 = Color3.new(1,1,1)
searchBox.ClearTextOnFocus = false

--// BUTTONS
local searchBtn = Instance.new("TextButton", main)
searchBtn.Size = UDim2.new(0.45,0,0,30)
searchBtn.Position = UDim2.new(0.05,0,0,75)
searchBtn.Text = "Search"
searchBtn.BackgroundColor3 = Color3.fromRGB(60,120,200)
searchBtn.TextColor3 = Color3.new(1,1,1)

local clearBtn = Instance.new("TextButton", main)
clearBtn.Size = UDim2.new(0.45,0,0,30)
clearBtn.Position = UDim2.new(0.5,0,0,75)
clearBtn.Text = "Clear"
clearBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
clearBtn.TextColor3 = Color3.new(1,1,1)

--// RESULT LIST
local resultFrame = Instance.new("ScrollingFrame", main)
resultFrame.Position = UDim2.new(0,10,0,115)
resultFrame.Size = UDim2.new(1,-20,1,-125)
resultFrame.CanvasSize = UDim2.new(0,0,0,0)
resultFrame.ScrollBarImageTransparency = 0
resultFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)

local list = Instance.new("UIListLayout", resultFrame)
list.Padding = UDim.new(0,4)

--// ESP STORAGE
local activeHighlights = {}

local function clearESP()
	for _,h in pairs(activeHighlights) do
		if h and h.Parent then
			h:Destroy()
		end
	end
	table.clear(activeHighlights)
end

local function clearResults()
	for _,v in pairs(resultFrame:GetChildren()) do
		if v:IsA("TextLabel") then
			v:Destroy()
		end
	end
	resultFrame.CanvasSize = UDim2.new(0,0,0,0)
	clearESP()
end

local function addResult(txt)
	local lbl = Instance.new("TextLabel", resultFrame)
	lbl.Size = UDim2.new(1,-8,0,26)
	lbl.BackgroundColor3 = Color3.fromRGB(50,50,50)
	lbl.TextWrapped = true
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Text = txt
	lbl.TextColor3 = Color3.new(1,1,1)
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 12

	resultFrame.CanvasSize = UDim2.new(0,0,0,list.AbsoluteContentSize.Y+6)
end

--// SEARCH LOGIC (DEX STYLE)
local function performSearch()
	clearResults()
	local keyword = string.lower(searchBox.Text)
	if keyword == "" then return end

	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			local backpack = plr:FindFirstChild("Backpack")
			if backpack then
				for _,item in ipairs(backpack:GetChildren()) do
					if string.find(string.lower(item.Name), keyword) then
						addResult("Player: "..plr.Name.." | Pet: "..item.Name)

						-- ESP HIGHLIGHT
						if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
							if not activeHighlights[plr] then
								local hl = Instance.new("Highlight")
								hl.FillColor = Color3.fromRGB(0,255,0)
								hl.OutlineColor = Color3.fromRGB(0,0,0)
								hl.FillTransparency = 0.3
								hl.Parent = plr.Character
								activeHighlights[plr] = hl
							end
						end
					end
				end
			end
		end
	end
end

searchBtn.MouseButton1Click:Connect(performSearch)
clearBtn.MouseButton1Click:Connect(clearResults)
